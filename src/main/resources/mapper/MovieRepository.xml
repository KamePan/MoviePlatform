<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.edu.ecnu.repository.MovieRepository" >

    <resultMap id="BaseMovieResultMap" type="cn.edu.ecnu.model.dataobject.MovieDO" >
        <id column="id" property="id" jdbcType="INTEGER" />
        <result column="title" property="title" jdbcType="VARCHAR" />
        <result column="url" property="url" jdbcType="VARCHAR" />
        <result column="cover" property="cover" jdbcType="VARCHAR" />
        <result column="length" property="length" jdbcType="INTEGER" />
    </resultMap>

    <resultMap id="UserRatingResultMap" type="cn.edu.ecnu.model.dataobject.RateDO" >
        <id column="id" property="id" />
        <result column="title" property="title"/>
        <result column="grading" property="rating"/>
    </resultMap>

    <sql id="Movie_Column_List" >
        id, title, url, cover, length, rate, showtime, actor,
        director, language, district, category, composer, othername
    </sql>

    <!-- MySQL -->
    <select id="selectMovieById" parameterType="java.lang.Integer" resultType="cn.edu.ecnu.model.dataobject.MovieDO" >
        SELECT
        <include refid="Movie_Column_List" />
        FROM movie
        WHERE id = #{id}
    </select>

    <select id="selectMovieByTitle" parameterType="java.lang.String" resultType="cn.edu.ecnu.model.dataobject.MovieDO" >
        SELECT
        <include refid="Movie_Column_List"></include>
        FROM movie
        WHERE title = #{title}
    </select>

    <insert id="insertBatchMovies" parameterType="java.util.List">
        INSERT INTO movie(
        title, url, cover, length, rate, showtime, actor,
        director, language, district, category, composer, othername
        )
        VALUES
        <foreach item="movie" collection="list" index="idx" open="" separator="," close="">
            (#{movie.title, jdbcType=VARCHAR},
            #{movie.url, jdbcType=VARCHAR},
            #{movie.cover, jdbcType=VARCHAR},
            #{movie.length, jdbcType=INTEGER},
            #{movie.rate, jdbcType=DOUBLE},
            #{movie.showtime, jdbcType=INTEGER},
            #{movie.actor, jdbcType=VARCHAR},
            #{movie.director, jdbcType=VARCHAR},
            #{movie.language, jdbcType=VARCHAR},
            #{movie.district, jdbcType=VARCHAR},
            #{movie.category, jdbcType=VARCHAR},
            #{movie.composer, jdbcType=VARCHAR},
            #{movie.othername, jdbcType=VARCHAR})
        </foreach>

    </insert>

    <!-- Neo4j -->
<!--    <select id="selectRatingMovieByUserId" parameterType="java.lang.Integer" resultMap="UserRatingResultMap" >-->
<!--        MATCH (u:User{id:#{id}})-[r:RATED]-(m:Movie)-->
<!--        WITH id(r) AS id, m.title AS title, r.grading AS grading-->
<!--        RETURN id, title, grading-->
<!--    </select>-->

</mapper>